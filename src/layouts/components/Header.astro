---
import HeaderLink from './HeaderLink.astro';
import { Image } from 'astro:assets';
import AvaLogo from '@src/assets/img/small-ava.jpg';
import GithubWhite from '@src/assets/img/github-mark-white.svg';
import GithubBlack from '@src/assets/img/github-mark.svg';
import LinkedinLight from '@src/assets/img/icons8-linkedin-white.svg';
import LinkedinDark from '@src/assets/img/icons8-linkedin.svg';
import HTBDark from '@src/assets/img/hackthebox-svgrepo-com (1).svg';
import HTBLight from '@src/assets/img/hackthebox-svgrepo-com.svg';


const menu = [
	{
		link: '/posts/',
		label: 'Posts'
	},
	{
		link: '/projects/',
		label: 'Projects'
	},
	  {
		link: '/about/',
		label: 'Whoami'
	},
	{
		link: '/tags/',
		label: 'Tags'
	},
];
---

<header
	id='site-header'
	class='w-full transition duration-300 z-[999]'
>
	<div class='container'>
		<nav class='flex gap-4 items-center justify-between py-4'>
			<div class='flex items-center gap-2'>
				<a href='/' class='text-purple-400 hover:text-amber-300 transition-colors duration-500' aria-label='Home'>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"/><path d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
					</svg>
				</a>
			</div>

			<!-- Desktop Menu -->
			<div class='hidden md:flex items-center gap-1'>
				{
					menu.map((item) => (
						<HeaderLink 
							class="py-2 px-4 text-sm font-mono font-medium text-gray-600 dark:text-gray-400 hover:text-purple-400 dark:hover:text-purple-400 transition-colors duration-200" 
							href={item.link}
						>
							{item.label}
						</HeaderLink>
					))
				}
			</div>

			<!-- Desktop Social Links -->
			<div class='hidden md:flex items-center gap-1'>
				<a class='p-2 text-gray-600 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400 transition-colors duration-200' href='https://www.linkedin.com/in/santiagomedinad' target='_blank' aria-label='LinkedIn'>
					<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
						<path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
					</svg>
				</a>

				<a class='p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors duration-200' href='https://github.com/tiagomedi' target='_blank' aria-label='GitHub'>
					<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
						<path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
					</svg>
				</a>

				<a class='p-2 group transition-colors duration-200' href='https://app.hackthebox.com/profile/2456457' target='_blank' aria-label='Hack The Box'>
					<div class="opacity-60 group-hover:opacity-100 [filter:brightness(0)_saturate(100%)_invert(44%)_sepia(8%)_saturate(629%)_hue-rotate(177deg)_brightness(95%)_contrast(88%)] dark:[filter:brightness(0)_saturate(100%)_invert(72%)_sepia(8%)_saturate(446%)_hue-rotate(177deg)_brightness(89%)_contrast(88%)] group-hover:[filter:brightness(0)_saturate(100%)_invert(68%)_sepia(56%)_saturate(434%)_hue-rotate(92deg)_brightness(95%)_contrast(86%)]">
						<Image src={HTBDark} width={20} height={20} alt='HTB' class="dark:hidden" />
						<Image src={HTBLight} width={20} height={20} alt='HTB' class="hidden dark:block" />
					</div>
				</a>

				<!-- <button class='p-2 text-gray-600 dark:text-gray-400 hover:text-green-400 transition-colors duration-200' id='themeToggle' aria-label='Theme mode'>
					<svg
						class='sun'
						xmlns='http://www.w3.org/2000/svg'
						width='20'
						height='20'
						viewBox='0 0 24 24'
						fill='none'
						stroke='currentColor'
						stroke-width='2'
						stroke-linecap='round'
						stroke-linejoin='round'
					>
						<circle cx='12' cy='12' r='4'></circle><path d='M12 2v2'></path><path d='M12 20v2'></path><path d='m4.93 4.93 1.41 1.41'></path><path d='m17.66 17.66 1.41 1.41'></path><path d='M2 12h2'></path><path d='M20 12h2'></path><path d='m6.34 17.66-1.41 1.41'></path><path d='m19.07 4.93-1.41 1.41'></path>
					</svg>
					<svg
						class='moon'
						xmlns='http://www.w3.org/2000/svg'
						width='20'
						height='20'
						viewBox='0 0 24 24'
						fill='none'
						stroke='currentColor'
						stroke-width='2'
						stroke-linecap='round'
						stroke-linejoin='round'
					> -->
						<path d='M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z'></path>
					</svg>
				</button>
			</div>

			<!-- Mobile Menu Button -->
			<button 
				id='menuToggle' 
				class='md:hidden p-2 text-gray-600 dark:text-gray-400 hover:text-purple-400 transition-colors duration-200 z-[1001]'
				aria-label='Toggle menu'
			>
				<svg id='hamburger' xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
					<line x1='3' y1='6' x2='21' y2='6'></line>
					<line x1='3' y1='12' x2='21' y2='12'></line>
					<line x1='3' y1='18' x2='21' y2='18'></line>
				</svg>
				<svg id='closeIcon' class='hidden' xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
					<line x1='18' y1='6' x2='6' y2='18'></line>
					<line x1='6' y1='6' x2='18' y2='18'></line>
				</svg>
			</button>
		</nav>
	</div>

	<!-- Mobile Sidebar -->
	<div 
		id='mobileSidebar' 
		class='fixed top-0 right-0 h-full w-64 bg-white/30 dark:bg-gray-900/30 backdrop-blur-xl border-l border-white/20 dark:border-gray-700/50 transform translate-x-full transition-transform duration-300 ease-in-out z-[1000] md:hidden shadow-2xl shadow-black/20'
	>
		<div class='flex flex-col h-full pt-20 px-6'>
			<!-- Mobile Menu Links -->
			<div class='flex flex-col gap-2 mb-8'>
				{
					menu.map((item) => (
						<a 
							href={item.link}
							class='mobile-menu-link py-3 px-4 text-base font-mono font-medium text-gray-700 dark:text-gray-300 hover:text-purple-400 dark:hover:text-purple-400 hover:bg-purple-50 dark:hover:bg-gray-800 rounded-lg transition-all duration-200 border-l-2 border-transparent hover:border-purple-400'
						>
							{item.label}
						</a>
					))
				}
			</div>

			<!-- Mobile Social Links -->
			<div class='flex items-center justify-center gap-4 pt-6 border-t border-gray-200 dark:border-gray-700'>
				<a class='p-2 text-gray-600 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400 transition-colors duration-200' href='https://www.linkedin.com/in/santiagomedinad' target='_blank' aria-label='LinkedIn'>
					<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
						<path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
					</svg>
				</a>

				<a class='p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors duration-200' href='https://github.com/tiagomedi' target='_blank' aria-label='GitHub'>
					<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
						<path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
					</svg>
				</a>

				<a class='p-2 group transition-colors duration-200' href='https://app.hackthebox.com/profile/2456457' target='_blank' aria-label='Hack The Box'>
					<div class="opacity-60 group-hover:opacity-100 [filter:brightness(0)_saturate(100%)_invert(44%)_sepia(8%)_saturate(629%)_hue-rotate(177deg)_brightness(95%)_contrast(88%)] dark:[filter:brightness(0)_saturate(100%)_invert(72%)_sepia(8%)_saturate(446%)_hue-rotate(177deg)_brightness(89%)_contrast(88%)] group-hover:[filter:brightness(0)_saturate(100%)_invert(68%)_sepia(56%)_saturate(434%)_hue-rotate(92deg)_brightness(95%)_contrast(86%)]">
						<Image src={HTBDark} width={24} height={24} alt='HTB' class="dark:hidden" />
						<Image src={HTBLight} width={24} height={24} alt='HTB' class="hidden dark:block" />
					</div>
				</a>
			</div>
		</div>
	</div>

	<!-- Overlay -->
	<div 
		id='sidebarOverlay' 
		class='fixed inset-0 bg-black/50 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300 z-[999] md:hidden'
	></div>

	<style is:global>
		#themeToggle .moon {
			display: none;
		}
		.dark #themeToggle .sun {
			display: none;
		}
		.dark #themeToggle .moon {
			display: block;
		}
		.container {
			margin-top: 0 !important;
			padding-top: 0 !important;
			}
	</style>

	<script is:inline>
		const theme = (() => {
			if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
				return 'dark';
			}
			if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
				return localStorage.getItem('theme');
			}
			return 'light';
		})();

		if (theme === 'light') {
			document.documentElement.classList.remove('dark');
		} else {
			document.documentElement.classList.add('dark');
		}

		window.localStorage.setItem('theme', theme || '');

		function sendMessage(message) {
			const iframe = document.querySelector('iframe.giscus-frame');
			if (!iframe) return;
			iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
		}

		const handleToggleClick = () => {
			const element = document.documentElement;
			element.classList.toggle('dark');

			const isDark = element.classList.contains('dark');
			if (isDark) {
				sendMessage({
					setConfig: {
						theme: 'dark_dimmed'
					}
				});
			} else {
				sendMessage({
					setConfig: {
						theme: 'light'
					}
				});
			}
			localStorage.setItem('theme', isDark ? 'dark' : 'light');
		};
		document.getElementById('themeToggle')?.addEventListener('click', handleToggleClick);

		// Mobile menu toggle
		const menuToggle = document.getElementById('menuToggle');
		const mobileSidebar = document.getElementById('mobileSidebar');
		const sidebarOverlay = document.getElementById('sidebarOverlay');
		const hamburger = document.getElementById('hamburger');
		const closeIcon = document.getElementById('closeIcon');
		const mobileMenuLinks = document.querySelectorAll('.mobile-menu-link');

		function openSidebar() {
			mobileSidebar?.classList.remove('translate-x-full');
			sidebarOverlay?.classList.remove('opacity-0', 'pointer-events-none');
			hamburger?.classList.add('hidden');
			closeIcon?.classList.remove('hidden');
			document.body.style.overflow = 'hidden';
		}

		function closeSidebar() {
			mobileSidebar?.classList.add('translate-x-full');
			sidebarOverlay?.classList.add('opacity-0', 'pointer-events-none');
			hamburger?.classList.remove('hidden');
			closeIcon?.classList.add('hidden');
			document.body.style.overflow = '';
		}

		menuToggle?.addEventListener('click', () => {
			if (mobileSidebar?.classList.contains('translate-x-full')) {
				openSidebar();
			} else {
				closeSidebar();
			}
		});

		sidebarOverlay?.addEventListener('click', closeSidebar);

		// Close sidebar when clicking a menu link
		mobileMenuLinks.forEach(link => {
			link.addEventListener('click', closeSidebar);
		});

		// Close sidebar on escape key
		document.addEventListener('keydown', (e) => {
			if (e.key === 'Escape' && !mobileSidebar?.classList.contains('translate-x-full')) {
				closeSidebar();
			}
		});

		// Close sidebar on window resize to desktop size
		window.addEventListener('resize', () => {
			if (window.innerWidth >= 768 && !mobileSidebar?.classList.contains('translate-x-full')) {
				closeSidebar();
			}
		});
	</script>
</header>
