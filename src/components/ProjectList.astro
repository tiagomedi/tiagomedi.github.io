---
import { Image } from 'astro:assets';
import type { Project } from '../pages/projects/projects'
import { kFormatter } from '../utils'
import GithubWhite from '@src/assets/img/github-mark-white.svg';
import GithubBlack from '@src/assets/img/github-mark.svg';

const { projects } = Astro.props

// Importar todas las imágenes de proyectos
const projectImages = import.meta.glob('@src/assets/img/projects/*.{png,jpg,jpeg,gif,webp}');

---
<div class="grid grid-cols-12 gap-5">
  {
    projects.map((project: Project, index: number) => {
      const imagePath = project.image ? `/projects/${project.image}` : null;
      
      return (
        <div class="col-span-12 sm:col-span-6 lg:col-span-4 project-card">
          {/* Imagen del Proyecto */}
          {imagePath && (
            <div class="project-image-container">
              <img 
                src={imagePath} 
                alt={project.name}
                class="project-image"
              />
              <div class="project-image-overlay"></div>
            </div>
          )}
          
          {/* Contenido del Proyecto */}
          <div class="project-content">
            {/* Tags y GitHub Stars */}
            <div class="flex justify-between items-start mb-2 gap-2">
              <div class='flex gap-1.5 flex-wrap'>
                {
                  (project.tags || [])?.map((tag: string) => (
                    <span
                      class='border border-yellow-400/40 dark:border-yellow-400/40 rounded
                        text-[0.688rem] text-yellow-300 dark:text-yellow-300 no-underline px-1.5 py-0.5
                        transition-all duration-300 bg-gray-800/50
                        hover:bg-yellow-400/20 hover:border-yellow-400'
                      >
                      {tag}
                    </span>
                  ))
                }
              </div>

              {project.stargazers_count !== undefined && (
                <div class='shrink-0'>
                  <a
                    href={project.html_url}
                    target="_blank"
                    class='border border-yellow-400/40 dark:border-yellow-400/40 rounded-lg
                        text-xs text-yellow-300 dark:text-yellow-300 no-underline px-2 py-1
                        transition-all duration-300 bg-gray-800/50
                        hover:bg-yellow-400/20 hover:border-yellow-400
                        flex items-center gap-1'
                  >
                    <Image src={GithubBlack} height={12} class='dark:hidden' alt='Github stars' />
                    <Image src={GithubWhite} height={12} class='hidden dark:block' alt='Github stars' />
                    {kFormatter(project.stargazers_count)} stars
                  </a>
                </div>
              )}
            </div>

            {/* Título */}
            <h3 class="project-title">
              <a class="hover:text-yellow-400 transition-colors duration-300" href={project.demoLink} target="_blank" rel={project.demoLinkRel}>
                {project.name}
              </a>
            </h3>

            {/* Descripción */}
            <div class="project-description">
              <p>{project.description}</p>
            </div>

            {/* Enlaces */}
            <div class="flex justify-end gap-2 mt-auto">
              {
                project.postLink &&
                <a class="project-link-icon" href={project.postLink} target="_blank" title="GitHub">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                </a>
              }
              {
                project.demoLink &&
                <a class="project-link-icon project-link-primary" href={project.demoLink} target="_blank" rel={project.demoLinkRel} title="Ver proyecto">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h6v6"/><path d="M10 14 21 3"/><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/></svg>
                </a>
              }
            </div>
          </div>

          <div class="project-glow"></div>
        </div>
      );
    })
  }
</div>

<style>
  /* ======= Proyectos - Cards con Imágenes ======= */
  .project-card {
    position: relative;
    background: linear-gradient(135deg, rgba(17, 24, 39, 0.8), rgba(31, 41, 55, 0.6));
    border: 2px solid rgba(234, 179, 8, 0.3);
    border-radius: 0.875rem;
    cursor: default;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
    opacity: 1;
  }

  .project-card:hover {
    border-color: rgba(234, 179, 8, 0.7);
    transform: translateY(-8px);
    box-shadow: 0 12px 40px rgba(234, 179, 8, 0.25), 0 0 30px rgba(234, 179, 8, 0.15);
  }

  /* ======= Imagen del Proyecto ======= */
  .project-image-container {
    position: relative;
    width: 100%;
    height: 160px;
    overflow: hidden;
    border-radius: 0.75rem 0.75rem 0 0;
  }

  .project-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .project-card:hover .project-image {
    transform: scale(1.08);
  }

  .project-image-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0) 0%,
      rgba(0, 0, 0, 0.3) 100%
    );
    transition: opacity 0.4s ease;
  }

  .project-card:hover .project-image-overlay {
    opacity: 0.6;
  }

  /* ======= Contenido del Proyecto ======= */
  .project-content {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    gap: 0.625rem;
  }

  .project-title {
    font-size: 1rem;
    font-weight: 700;
    color: #fbbf24;
    line-height: 1.3;
    transition: color 0.3s ease;
  }

  .project-title a {
    text-decoration: none;
    cursor: pointer;
  }

  .project-description {
    font-size: 0.8125rem;
    color: #d1d5db;
    line-height: 1.5;
    flex-grow: 1;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* ======= Enlaces (Solo Iconos) ======= */
  .project-link-icon {
    color: #fde68a;
    text-decoration: none;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    border-radius: 0.5rem;
    border: 1px solid rgba(234, 179, 8, 0.3);
    background: rgba(234, 179, 8, 0.1);
    cursor: pointer;
  }

  .project-link-icon:hover {
    color: #1f2937;
    background: #fbbf24;
    border-color: #fbbf24;
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 4px 12px rgba(234, 179, 8, 0.3);
  }

  .project-link-icon.project-link-primary {
    background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(234, 179, 8, 0.1));
    border-color: rgba(234, 179, 8, 0.5);
  }

  .project-link-icon.project-link-primary:hover {
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    border-color: #fbbf24;
    color: #1f2937;
  }

  /* ======= Efecto de brillo ======= */
  .project-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(234, 179, 8, 0.12), transparent 70%);
    transform: translate(-50%, -50%) scale(0);
    transition: transform 0.5s ease;
    pointer-events: none;
    opacity: 0;
  }

  .project-card:hover .project-glow {
    transform: translate(-50%, -50%) scale(1.5);
    opacity: 1;
  }
</style>
