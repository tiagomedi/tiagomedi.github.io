---
import { Image } from 'astro:assets';
import type { Project } from '../pages/projects/projects'
import { kFormatter } from '../utils'
import GithubWhite from '@src/assets/img/github-mark-white.svg';
import GithubBlack from '@src/assets/img/github-mark.svg';

const { projects } = Astro.props

// Funci√≥n para asignar emoji seg√∫n las tags del proyecto
const getProjectEmoji = (project: Project) => {
  const tags = (project.tags || []).map(tag => tag.toLowerCase()).join(' ');
  
  if (tags.includes('landing') || tags.includes('corporativo') || tags.includes('web')) return 'üåê';
  if (tags.includes('data science') || tags.includes('ml')) return 'üìä';
  if (tags.includes('qa') || tags.includes('llm')) return 'ü§ñ';
  if (tags.includes('soa') || tags.includes('docker') || tags.includes('microservicios')) return 'üê≥';
  if (tags.includes('security') || tags.includes('cybersecurity')) return 'üîí';
  if (tags.includes('blockchain')) return '‚õìÔ∏è';
  if (tags.includes('mobile') || tags.includes('app')) return 'üì±';
  if (tags.includes('game')) return 'üéÆ';
  if (tags.includes('ai') || tags.includes('artificial')) return 'üß†';
  
  return 'üöÄ'; // Default
}

---
<div class="grid grid-cols-12 gap-5">
  {
    projects.map((project: Project, index: number) => 
      <div class="col-span-12 sm:col-span-6 lg:col-span-4 project-badge group" data-unlocked="true" style={`animation-delay: ${index * 0.1}s`}>
        <div class="project-icon">{getProjectEmoji(project)}</div>
        
        <div class="flex justify-between items-center mb-3">
          <div class='flex gap-2 flex-wrap'>
            {
              (project.tags || [] )?.map((tag: string) => (
                <span
                  class='border border-purple-400/40 dark:border-purple-400/40 rounded-lg
                    text-sm text-purple-300 dark:text-purple-300 no-underline px-2 py-0.5
                    transition-all duration-300 bg-gray-800/50
                    hover:bg-purple-400/20 hover:border-purple-400'
                  >
                  {tag}
                </span>
              ))
            }
          </div>

          {project.stargazers_count !== undefined && (
            <div class='shrink-0'>
              <a
                href={project.html_url}
                target="_blank"
                class='border border-purple-400/40 dark:border-purple-400/40 rounded-lg
                    text-xs text-purple-300 dark:text-purple-300 no-underline px-2 py-1
                    transition-all duration-300 bg-gray-800/50
                    hover:bg-purple-400/20 hover:border-purple-400
                    flex items-center gap-1'
              >
                <Image src={GithubBlack} height={12} class='dark:hidden' alt='Github stars' />
                <Image src={GithubWhite} height={12} class='hidden dark:block' alt='Github stars' />
                {kFormatter(project.stargazers_count)} stars
              </a>
            </div>
          )}
        </div>

        <h3 class="project-title">
          <a class="hover:text-purple-400 transition-colors duration-300" href={project.demoLink} target="_blank" rel={project.demoLinkRel}>{project.name}</a>
        </h3>

        <div class="project-description">
          <p>{project.description}</p>
        </div>

        <div class="flex justify-end gap-3 mt-auto">
          {
            project.postLink &&
            <a class="project-link" href={project.postLink}>
              Repositorio
            </a>
          }
          {
            project.demoLink &&
            <a class="project-link" href={project.demoLink} target="_blank" rel={project.demoLinkRel}>
              Enlace 
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link"><path d="M15 3h6v6"/><path d="M10 14 21 3"/><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/></svg>
            </a>
          }
        </div>

        <div class="project-glow"></div>
      </div>
    )
  }
</div>

<style>
  /* ======= Proyectos - Badges Animados ======= */
  .project-badge {
    position: relative;
    background: linear-gradient(135deg, rgba(17, 24, 39, 0.7), rgba(31, 41, 55, 0.5));
    border: 2px solid rgba(168, 85, 247, 0.4);
    border-radius: 1rem;
    padding: 1.5rem 1.25rem;
    cursor: pointer;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
    transform: translateY(20px) scale(0.95);
    animation: unlockProject 0.6s ease forwards;
    min-height: 240px;
    display: flex;
    flex-direction: column;
  }

  @keyframes unlockProject {
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .project-badge:hover {
    transform: translateY(-10px) scale(1.02);
    border-color: rgba(251, 191, 36, 0.6);
    box-shadow: 
      0 0 30px rgba(168, 85, 247, 0.3),
      0 0 50px rgba(251, 191, 36, 0.15);
  }

  .project-icon {
    font-size: 2rem;
    text-align: center;
    margin-bottom: 0.75rem;
    filter: drop-shadow(0 0 10px rgba(168, 85, 247, 0.5));
    transition: all 0.3s ease;
  }

  .project-badge:hover .project-icon {
    transform: scale(1.15) rotate(-5deg);
    filter: drop-shadow(0 0 20px rgba(251, 191, 36, 0.8));
  }

  .project-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: #fbbf24;
    margin-bottom: 0.75rem;
    line-height: 1.3;
  }

  .project-description {
    font-size: 0.875rem;
    color: #d1d5db;
    line-height: 1.5;
    margin-bottom: 1.25rem;
    flex-grow: 1;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    min-height: 50px;
  }

  .project-link {
    color: #a78bfa;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .project-link:hover {
    color: #fbbf24;
    transform: translateX(3px);
  }

  .project-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(168, 85, 247, 0.2), transparent 70%);
    transform: translate(-50%, -50%) scale(0);
    transition: transform 0.5s ease;
    pointer-events: none;
    opacity: 0;
  }

  .project-badge:hover .project-glow {
    transform: translate(-50%, -50%) scale(1.5);
    opacity: 1;
  }

  /* Efecto de pulso para todos los proyectos */
  @keyframes pulse-project {
    0%, 100% {
      box-shadow: 0 0 10px rgba(168, 85, 247, 0.2);
    }
    50% {
      box-shadow: 0 0 15px rgba(251, 191, 36, 0.25);
    }
  }

  .project-badge[data-unlocked="true"] {
    animation: unlockProject 0.6s ease forwards, pulse-project 4s ease-in-out infinite 1.5s;
  }
</style>
